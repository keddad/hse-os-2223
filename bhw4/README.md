# ИДЗ4
Бирюлин Никита Андреевич, БПИ213, вариант 22

```
После нового года в библиотеке университета обнаружилась пропажа каталога. После поиска и наказания виноватых, ректор дал указание восстановить каталог силами студентов. Фонд библиотека представляет собой прямоугольное помещение, в котором находится M рядов по N шкафов по K книг в каждом шкафу. Требуется создать приложение, составляющее каталог. В качестве отдельного процесса задается составление подкаталога одним студентом–процессом для одного ряда. После этого студент передает информацию процессу библиотекарю, который сортирует ее учитывая подкаталоги, переданные другими студентами.
```

Описание ниже повторяет описание ИДЗ3, т.к. поменялась только реализация взаимодействия между клиентами. Изменилось только описание обработки/создания запросов.

Тут нет типичной разбивки по баллам, т.к. по факту все задание - одна реализация. Код собирается с помощью CMake. Есть три таргета - server, client, observer. Кроме того, собирается библиотека liblibrary - она описывает две структуры данных (Book - информация о книге, Library - сортированный индекс книг), функции для их сериализации и десериализации, конструирования, очистки и печати. Они используются непосредственно в приложениях.

Сервер - злой библиотекарь, который отправил студентов сортировать книги. Он не принимает аргументов при запуске. Он принимает два типа запросов:
* Запрос на добавление книги. {CRC (4b), 0x0, serislized_book}. При получении проверяется CRC сообщения для обеспечения корректности данных. В случае повторного получения сообщения книга вставлена не будет. В качестве ответа отправляется CRC всего сообщения (вместе с CRC от клиента).
* Запрос на получение реестра книг. {CRC (4b). 0x1}. Аналогично проверяется CRC. В ответ отправляется сообщение вида (CRC (4b), serialized_library), где CRC - CRC сериализованной библиотеки.

Клиент - бедный студент, на которого свалилось такое несчастье. Он обходит книги в папке (тестовая библиотека в папке library). Его стоит запустить в этой папке, передав ему имя хоста-сервера и ряд, который он обслуживает. После этого он отправит серверу все книги в этом ряду с задержкой между книгами для симуляции работы. После отправки каждой книги проверяется CRC ответа в соответствии с схемой ниже. Если что-то пошло не так, перед обьявлением смерти сервеа (библиотекаря) клиент пытается отправить книгу несколько раз.

Наблюдатель - злой ректор. Злых ректоров может быть много (как, впрочем, и студентов). Злой ректор регулярно требует у библиотекаря отчет о работе, и получает текущую версию индекса книг. При получении реестра проверяется его CRC. Аналогично работает система повторов.

И клиенты, и наблюдатели могут подключаться/отключаться в любой момент работы в любых количествах. Сценарий неожиданной смерти сервера тоже предусмотрен: если любой из клиентов неожиданно не может подключиться к серверу, или проблемы возникли после подключения, клиент корректно завершается. Сервер корректно завершается по Ctrl+C. Таким образом, работа выполнена на максимальный балл.

Т.к. тут довольно много взаимодействующих частей, записал небольшое демо-видео с примерами работы: https://youtu.be/55H1BBQdcOM